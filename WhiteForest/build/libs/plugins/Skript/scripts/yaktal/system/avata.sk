# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
# â”ƒ ğŸ§  ë©”íƒ€ë²„ìŠ¤ ì•„ë°”íƒ€ ì‹œìŠ¤í…œ - Citizen ì¸ë²¤í† ë¦¬ ì €ì¥/ë³µì› ë¡œì§ â”ƒ
# â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
#
# ğŸ“Œ ê¸°ëŠ¥ ìš”ì•½:
# - í”Œë ˆì´ì–´ê°€ ì„œë²„ë¥¼ ë‚˜ê°€ë©´ í•´ë‹¹ ìœ„ì¹˜ì— Citizen NPCë¥¼ ìƒì„±í•˜ê³  ì¸ë²¤í† ë¦¬ ë° ì¥ë¹„ë¥¼ ì €ì¥í•¨
# - ë‹¤ì‹œ ì ‘ì†í•˜ë©´ Citizenì„ ì œê±°í•˜ê³  ì €ì¥ëœ ì¸ë²¤í† ë¦¬ë¥¼ ë³µì›í•¨
# - NPCë¥¼ í´ë¦­í•˜ë©´ í•´ë‹¹ í”Œë ˆì´ì–´ì˜ ì¸ë²¤í† ë¦¬ë¥¼ GUIë¡œ ì—´ ìˆ˜ ìˆìŒ
# - GUIì—ì„œ ì¸ë²¤í† ë¦¬ë¥¼ ìˆ˜ì •í•˜ë©´ Citizenì˜ ì¥ë¹„ë„ ì‹¤ì‹œê°„ìœ¼ë¡œ ë°˜ì˜ë¨
#
# ğŸ“¦ ì£¼ìš” ë³€ìˆ˜ êµ¬ì¡°:
# - {quit::%uuid%::cid} â†’ í”Œë ˆì´ì–´ì˜ Citizen ID
# - {quit::npc::%cid%::uuid} â†’ Citizen IDë¡œ í”Œë ˆì´ì–´ UUID ì—­ì°¸ì¡°
# - {quit::%uuid%::inv::*} â†’ ì¸ë²¤í† ë¦¬ ìŠ¬ë¡¯ ë° ì¥ë¹„ ì €ì¥
# - {open::%uuid%::opuuid} â†’ í˜„ì¬ ì¸ë²¤í† ë¦¬ë¥¼ ì—´ê³  ìˆëŠ” ëŒ€ìƒ UUID
# - {opened::%uuid%::op} â†’ ì¸ë²¤í† ë¦¬ ì—´ë¦¼ ìƒíƒœ í™•ì¸
#
# ğŸ› ï¸ ì£¼ìš” ì´ë²¤íŠ¸:
# - on quit â†’ Citizen ìƒì„± ë° ì¸ë²¤í† ë¦¬ ì €ì¥
# - on join â†’ Citizen ì œê±° ë° ì¸ë²¤í† ë¦¬ ë³µì›
# - on npc right click â†’ GUI ì¸ë²¤í† ë¦¬ ì—´ê¸°
# - on inventory closing â†’ ì¸ë²¤í† ë¦¬ ì €ì¥ ë° Citizen ì¥ë¹„ ì—…ë°ì´íŠ¸
# - on inventory click â†’ barrier í´ë¦­ ë°©ì§€
#
# âœ¨ í™•ì¥ ê°€ëŠ¥ ì•„ì´ë””ì–´:
# - Citizenì´ í”Œë ˆì´ì–´ì²˜ëŸ¼ ì›€ì§ì´ê²Œ í•˜ê¸°
# - ì¸ë²¤í† ë¦¬ ë³€ê²½ ë¡œê·¸ ì €ì¥
# - Citizen ìœ„ì— í”Œë ˆì´ì–´ ì´ë¦„ ë° ì ‘ì† ì‹œê°„ í‘œì‹œ
#
# ì‘ì„±ì: ìƒí˜„ ğŸ˜
# ì‘ì„±ì¼: 2025-08-26



on join:
    if {quit::%uuid of player%::cid} is set:
        remove citizen {quit::%uuid of player%::cid}
        delete {quit::%uuid of player%::cid}
        
        if {opened::%uuid of player%::op} is set:
            close {openingplayer::%uuid of player%::player}'s inventory
            wait 10 tick
            loop 36 times:
                set {_loop-number} to loop-number - 1
                set slot {_loop-number} of player to {quit::%uuid of player%::inv::%{_loop-number}%}
            set player's helmet to {quit::%uuid of player%::inv::helmet}
            set player's chestplate to {quit::%uuid of player%::inv::chestplate}
            set player's leggings to {quit::%uuid of player%::inv::leggings}
            set player's boots to {quit::%uuid of player%::inv::boots}
            set player's offhand item to {quit::%uuid of player%::inv::offhand}
            delete {quit::%uuid of player%::inv::*}
            set {quit::%uuid of player%::inv::change} to false

        if {opened::%uuid of player%::op} is not set:
            if {quit::%uuid of player%::inv::change} is true:
                loop 36 times:
                    set {_loop-number} to loop-number - 1
                    set slot {_loop-number} of player to {quit::%uuid of player%::inv::%{_loop-number}%}
                set player's helmet to {quit::%uuid of player%::inv::helmet}
                set player's chestplate to {quit::%uuid of player%::inv::chestplate}
                set player's leggings to {quit::%uuid of player%::inv::leggings}
                set player's boots to {quit::%uuid of player%::inv::boots}
                set player's offhand item to {quit::%uuid of player%::inv::offhand}
                delete {quit::%uuid of player%::inv::*}
                set {quit::%{open::%uuid of player%::opuuid}%::inv::change} to false
                        

    
    #cid ìˆìœ¼ë©´ ë©”íƒ€ë²„ìŠ¤ ì¼€ë¦­í„° ì œê±°

on quit:
    create a citizen named "%player%" at location of player
    set {quit::%uuid of player%::cid} to last created citizen id
    set citizen {quit::%uuid of player%::cid}'s gravity to off
    set {_cid} to {quit::%uuid of player%::cid}
    set {quit::npc::%{_cid}%::uuid} to uuid of player 
    # quit/uuid/cid ì— citizen id ì €ì¥
    # quit/npc/%cid%/uuid ì— í”Œë ˆì´ì–´ uuid ì €ì¥
    change citizen {quit::%uuid of player%::cid} skin to "%player%"
    #ìŠ¤í‚¨ ë³€ê²½
    #ë©”íƒ€ë²„ìŠ¤ ì¼€ë¦­í„° ìƒì„±
    
    loop 36 times:
    #ì‹œ@ë°œ ì™œ 1ë¶€í„° ì‹œì‘í•¨???? ì¼ë‹¨ ì„ì‹œë¡œ -1 ë¶™ì—¬ì„œ ì €ì¥í•¨
        set {_loop-number} to loop-number - 1
        set {quit::%uuid of player%::inv::%{_loop-number}%} to slot {_loop-number} of player 
    #quit/uuid/inv/0~35 ì— ì¸ë²¤í† ë¦¬ ì €ì¥

    set {_helmet} to player's helmet
    set {_chestplate} to player's chestplate
    set {_leggings} to player's leggings
    set {_boots} to player's boots

    set {quit::%uuid of player%::inv::helmet} to {_helmet}
    set {quit::%uuid of player%::inv::chestplate} to {_chestplate}
    set {quit::%uuid of player%::inv::leggings} to {_leggings}
    set {quit::%uuid of player%::inv::boots} to {_boots}
    #quit/uuid/inv/helmet ë“±ë“±ì— ê°‘ì˜· ì €ì¥

    set {quit::%uuid of player%::inv::offhand} to player's offhand item

    set {quit::%uuid of player%::inv::empty} to false

    equip citizen {quit::%uuid of player%::cid} with player's helmet
    equip citizen {quit::%uuid of player%::cid} with player's chestplate
    equip citizen {quit::%uuid of player%::cid} with player's leggings
    equip citizen {quit::%uuid of player%::cid} with player's boots
    set citizen {quit::%uuid of player%::cid}'s tool to player's tool
    set citizen {quit::%uuid of player%::cid}'s offhand item to player's offhand
    #í”Œë ˆì´ì–´ì˜ ê°‘ì˜·ì„ ì¼€ë¦­í„°ì— ë„£ìŒ

    
    
    set {_citizen::uuid} to uuid of {quit::%uuid of player%::cid}
    #npc í´ë¦­ì‹œ npc id ì™€ npc uuid ê°€ì ¸ì˜´

on npc right click:
    set {_cid} to event-number
    set {uuid of player::op} to {_cid}
    set {_uuid} to {quit::npc::%{_cid}%::uuid}
    set {openingplayer::%{_uuid}%::player} to player
    if {opened::%{_uuid}%::op} is set:
        send "&cì´ë¯¸ ë‹¤ë¥¸ í”Œë ˆì´ì–´ê°€ ì´ ì¸ë²¤í† ë¦¬ë¥¼ ì—´ê³ ìˆìŠµë‹ˆë‹¤!" to player
        stop
    if {quit::npc::%{_cid}%::uuid} is set:
        set {_uuid} to {quit::npc::%{_cid}%::uuid}
        set {open::%uuid of player%::opuuid} to {_uuid}
        set {opened::%{_uuid}%::op} to uuid of player

        #_uuid = npc í´ë¦­ì‹œ í”Œë ˆì´ì–´ uuid

        set {_player} to ({_uuid} parsed as offline player)
        #npc í´ë¦­ì‹œ ëˆ„êµ¬ ì•„ë°”íƒ€ì¸ì§€ ì•Œë ¤ì¤Œ
        #npc í´ë¦­ì‹œ npc ì•„ì´ë””ë¥¼ í†µí•´ í”Œë ˆì´ì–´ì˜ ì•„ë°”íƒ€ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŒ

        if {quit::%{_uuid}%::inv::empty} is true:
            send "&c%name of {_player}% does not have a saved inventory." to player
            stop

        # 5í–‰ ì²´ìŠ¤íŠ¸ ìƒì„±
        set {inv::%{_uuid}%} to a new chest inventory with 6 rows named "&fî®»îªª&e%name of {_player}%'s Inventory"

        # ì¼ë°˜ ìŠ¬ë¡¯ 0~35 ë³µì›
        loop 36 times:
            set {_loop-number} to loop-number - 1


            if {_loop-number} is between 0 and 8:
                set {_slot::num} to {_loop-number} + 45
                set slot {_slot::num} of {inv::%{_uuid}%} to {quit::%{_uuid}%::inv::%{_loop-number}%}

            if {_loop-number} is between 9 and 35:
                set {_slot::num} to {_loop-number} + 9
                set slot {_slot::num} of {inv::%{_uuid}%} to {quit::%{_uuid}%::inv::%{_loop-number}%}

        loop 9 times:
            set {_slot} to loop-number + 9 - 1
            set slot {_slot} of {inv::%{_uuid}%} to barrier named " " with custom model data 1
        loop 4 times:
            set {_slot} to loop-number + 4 - 1
            set slot {_slot} of {inv::%{_uuid}%} to barrier named " " with custom model data 1


        # ê°‘ë°” ë° ì˜¤í”„í•¸ë“œ í‘œì‹œìš© ìŠ¬ë¡¯
        set slot 0 of {inv::%{_uuid}%} to {quit::%{_uuid}%::inv::helmet}
        set slot 1 of {inv::%{_uuid}%} to {quit::%{_uuid}%::inv::chestplate}
        set slot 2 of {inv::%{_uuid}%} to {quit::%{_uuid}%::inv::leggings}
        set slot 3 of {inv::%{_uuid}%} to {quit::%{_uuid}%::inv::boots}
        set slot 8 of {inv::%{_uuid}%} to {quit::%{_uuid}%::inv::offhand}

        # ì²´ìŠ¤íŠ¸ ì—´ê¸°
        open {inv::%{_uuid}%} to player 

on inventory close:
    if {open::%uuid of player%::opuuid} is set:
        loop 54 times:

            set {_loop-number} to loop-number - 1
            
            if {_loop-number} is between 0 and 17:
                if {_loop-number} is 0:
                    set {quit::%{open::%uuid of player%::opuuid}%::inv::helmet} to slot {_loop-Number} of event-inventory
                if {_loop-number} is 1:
                    set {quit::%{open::%uuid of player%::opuuid}%::inv::chestplate} to slot {_loop-Number} of event-inventory
                if {_loop-number} is 2:
                    set {quit::%{open::%uuid of player%::opuuid}%::inv::leggings} to slot {_loop-Number} of event-inventory
                if {_loop-number} is 3:
                    set {quit::%{open::%uuid of player%::opuuid}%::inv::boots} to slot {_loop-Number} of event-inventory
                if {_loop-number} is 8:
                    set {quit::%{open::%uuid of player%::opuuid}%::inv::offhand} to slot {_loop-Number} of event-inventory
                
            if {_loop-number} is between 18 and 44:
                set {_slot} to {_loop-number} - 9
                set {quit::%{open::%uuid of player%::opuuid}%::inv::%{_slot}%} to slot {_loop-Number} of event-inventory


            if {_loop-number} is between 45 and 53:
                set {_slot} to {_loop-number} - 45 
                set {quit::%{open::%uuid of player%::opuuid}%::inv::%{_slot}%} to slot {_loop-Number} of event-inventory
        
        set {quit::%{open::%uuid of player%::opuuid}%::inv::change} to true

        set citizen {quit::%{open::%uuid of player%::opuuid}%::cid}'s helmet to {quit::%{open::%uuid of player%::opuuid}%::inv::helmet}
        set citizen {quit::%{open::%uuid of player%::opuuid}%::cid}'s chestplate to {quit::%{open::%uuid of player%::opuuid}%::inv::chestplate}
        set citizen {quit::%{open::%uuid of player%::opuuid}%::cid}'s leggings to {quit::%{open::%uuid of player%::opuuid}%::inv::leggings}
        set citizen {quit::%{open::%uuid of player%::opuuid}%::cid}'s boots to {quit::%{open::%uuid of player%::opuuid}%::inv::boots}
        set citizen {quit::%{open::%uuid of player%::opuuid}%::cid}'s tool to {quit::%{open::%uuid of player%::opuuid}%::inv::0}
        set citizen {quit::%{open::%uuid of player%::opuuid}%::cid}'s offhand item to {quit::%{open::%uuid of player%::opuuid}%::inv::offhand}

        delete {open::%uuid of player%::opuuid}
        set {_opuuid} to {quit::npc::%{uuid of player::op}%::uuid}
        delete {opened::%{_opuuid}%::op}

on inventory click:
    if event-item is barrier:
        cancel event

